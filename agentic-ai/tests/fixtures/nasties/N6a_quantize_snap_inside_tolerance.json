{
  "id": "N6a_quantize_snap_inside_tolerance",
  "description": "Quantize snap at boundary: deliver_at just inside max_snap_ms snaps to current boundary",
  "now_ms": 1001580,
  "musical": {
    "bpm": 80,
    "meter": "4/4",
    "bars": 2,
    "subdivision": "8n",
    "grid_start_ms": 1001500,
    "slot_ms": 375
  },
  "takeFinalized": {
    "type": "TakeFinalized",
    "t_ms": 1001550,
    "exercise_id": "2bar_eighth_down",
    "take_id": "take_n6a_001",
    "timing": {
      "take_start_ms": 1000000,
      "count_in_start_ms": 1000000,
      "play_start_ms": 1001500,
      "expected_grid_start_ms": 1001500,
      "expected_grid_end_ms": 1007500,
      "finalize_reason": "GRID_COMPLETE"
    },
    "context": {
      "meter": "4/4",
      "bars": 2,
      "bpm_target": 80,
      "bpm_tolerance": 6,
      "subdivision": "8n",
      "count_in_beats": 2,
      "pattern_id": "2bar_eighth_down"
    },
    "events": []
  },
  "segmenterFlags": {
    "late_start": false,
    "missed_count_in": false,
    "extra_events_after_end": false,
    "extra_bars": false,
    "partial_take": false,
    "tempo_mismatch": false,
    "restart_detected": false,
    "low_confidence_events": 0
  },
  "finalize_reason": "GRID_COMPLETE",
  "takeAnalysis": {
    "type": "TakeAnalysis",
    "exercise_id": "2bar_eighth_down",
    "take_id": "take_n6a_001",
    "metrics": {
      "hit_rate": 0.75,
      "miss_rate": 0.25,
      "extra_rate": 0.00,
      "mean_offset_ms": 15,
      "median_offset_ms": 12,
      "std_offset_ms": 22,
      "p90_abs_offset_ms": 45,
      "drift_ms_per_bar": 8,
      "stability": 0.72
    },
    "grid": {
      "grid_start_ms": 1001500,
      "slot_ms": 375,
      "total_slots": 16,
      "expected_slots": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
    },
    "alignment": {
      "matched": [
        { "slot": 0, "seq": 601, "offset_ms": 10 },
        { "slot": 1, "seq": 602, "offset_ms": 15 },
        { "slot": 2, "seq": 603, "offset_ms": 18 },
        { "slot": 3, "seq": 604, "offset_ms": 12 },
        { "slot": 4, "seq": 605, "offset_ms": 20 },
        { "slot": 5, "seq": 606, "offset_ms": 8 },
        { "slot": 6, "seq": 607, "offset_ms": 22 },
        { "slot": 7, "seq": 608, "offset_ms": 14 },
        { "slot": 8, "seq": 609, "offset_ms": 16 },
        { "slot": 9, "seq": 610, "offset_ms": 10 },
        { "slot": 10, "seq": 611, "offset_ms": 18 },
        { "slot": 11, "seq": 612, "offset_ms": 12 }
      ],
      "missed_slots": [12, 13, 14, 15],
      "extra_seqs": []
    },
    "quality": {
      "event_confidence_mean": 0.85
    }
  },
  "userSignals": {
    "mode": "PRACTICE",
    "backoff": "L0",
    "timeSinceLastNoteOnMs": 80,
    "phraseBoundaryDetected": false,
    "timeSincePhraseBoundaryMs": 0,
    "ignoreStreak": 0,
    "silencePreference": 0.1,
    "userExplicitQuiet": false
  },
  "policyConfig": {
    "minPauseMs": 500,
    "betweenPhraseOnly": false,
    "interruptBudgetPerMin": 3.0
  },
  "deviceCapabilities": {
    "modalitiesAvailable": ["haptic", "visual"]
  },
  "pulseConfig": {
    "deliver_at_ms": 1001579,
    "max_snap_ms": 80,
    "grid_boundary_ms": 1001500,
    "comment": "deliver_at is 79ms past boundary, within 80ms tolerance"
  },
  "expected": {
    "intent": "repeat_once",
    "cue_key": "one_more_take_same_tempo",
    "shouldInitiate": false,
    "suppression_reason": "insufficient_pause",
    "first_pulse_time_ms": 1001500,
    "snap_direction": "backward",
    "snap_behavior": "deliver_at 1001579 snaps back to 1001500 (79ms < 80ms tolerance)",
    "comment": "Metrics (hit_rate=0.75, p90=45) fall through to repeat_once. Pulse snap test validates quantization."
  }
}
