{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://tap-tone.local/schemas/viewer_pack_v1.schema.json",
  "title": "tap_tone_pi Viewer Pack Manifest v1",
  "description": "Measurement-only viewer bundle manifest for tap_tone_pi. Contains raw and derived evidence suitable for laboratory-grade visualization without interpretation.",
  "type": "object",
  "additionalProperties": false,

  "_vendored_from": "tap_tone_pi/contracts/viewer_pack_v1.schema.json",
  "_vendored_note": "This is a vendored copy. Source of truth is in tap_tone_pi repo. Update via schema parity gate.",

  "required": [
    "schema_version",
    "schema_id",
    "created_at_utc",
    "source_capdir",
    "detected_phase",
    "measurement_only",
    "interpretation",
    "points",
    "contents",
    "files",
    "bundle_sha256"
  ],

  "properties": {
    "schema_version": {
      "type": "string",
      "const": "v1"
    },

    "schema_id": {
      "type": "string",
      "const": "viewer_pack_v1"
    },

    "created_at_utc": {
      "type": "string",
      "description": "UTC timestamp when the viewer pack was generated.",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
    },

    "source_capdir": {
      "type": "string",
      "description": "Logical name of the source capture/session directory (not a filesystem path).",
      "minLength": 1
    },

    "detected_phase": {
      "type": "string",
      "description": "Detected measurement phase of the source data.",
      "enum": ["phase1", "phase2", "unknown"]
    },

    "measurement_only": {
      "type": "boolean",
      "const": true,
      "description": "Hard assertion that this bundle contains no interpretation, scoring, or recommendations."
    },

    "interpretation": {
      "type": "string",
      "enum": ["deferred"],
      "description": "Explicit declaration that interpretive meaning is intentionally absent."
    },

    "points": {
      "type": "array",
      "description": "List of point IDs included in this pack (e.g., ['A1', 'A2', 'B1']). Avoids directory walking.",
      "items": { "type": "string", "minLength": 1 }
    },

    "contents": {
      "type": "object",
      "additionalProperties": false,
      "required": ["audio", "spectra", "coherence", "ods", "wolf", "plots"],
      "properties": {
        "audio": { "type": "boolean" },
        "spectra": { "type": "boolean" },
        "coherence": { "type": "boolean" },
        "ods": { "type": "boolean" },
        "wolf": { "type": "boolean" },
        "plots": { "type": "boolean" },
        "provenance": { "type": "boolean" }
      }
    },

    "files": {
      "type": "array",
      "description": "List of all files included in the viewer pack.",
      "items": { "$ref": "#/$defs/fileEntry" }
    },

    "bundle_sha256": {
      "type": "string",
      "description": "SHA256 hash of the canonicalized manifest (excluding this field).",
      "pattern": "^[a-f0-9]{64}$"
    }
  },

  "$defs": {
    "fileEntry": {
      "type": "object",
      "additionalProperties": false,
      "required": ["relpath", "sha256", "bytes", "mime", "kind"],

      "properties": {
        "relpath": {
          "type": "string",
          "description": "Forward-slash relative path inside the viewer pack.",
          "pattern": "^[^\\\\]+$"
        },

        "sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        },

        "bytes": {
          "type": "integer",
          "minimum": 0
        },

        "mime": {
          "type": "string",
          "minLength": 1
        },

        "kind": {
          "type": "string",
          "description": "Viewer-facing classification (non-interpretive).",
          "enum": [
            "audio_raw",
            "spectrum_csv",
            "analysis_peaks",
            "coherence",
            "transfer_function",
            "wolf_candidates",
            "wsi_curve",
            "provenance",
            "plot_png",
            "session_meta",
            "manifest",
            "unknown"
          ]
        }
      }
    }
  }
}
