{
  "id": "N6a_quantize_snap_inside_tolerance",
  "now_ms": 1001579,
  "musical": {
    "bpm": 80,
    "meter": "4/4",
    "bars": 2,
    "subdivision": "8n",
    "grid_start_ms": 1003079,
    "slot_ms": 375
  },
  "takeAnalysis": {
    "type": "TakeAnalysis",
    "exercise_id": "2bar_eighth_down",
    "take_id": "take_N6a",
    "metrics": {
      "hit_rate": 0.88,
      "miss_rate": 0.12,
      "extra_rate": 0.05,
      "mean_offset_ms": 4,
      "median_offset_ms": 3,
      "std_offset_ms": 26,
      "p90_abs_offset_ms": 62,
      "drift_ms_per_bar": 8,
      "stability": 0.63
    },
    "grid": {
      "grid_start_ms": 1003079,
      "slot_ms": 375,
      "total_slots": 16,
      "expected_slots": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
    },
    "alignment": {
      "matched": [
        { "slot": 0, "seq": 1601, "offset_ms": 18 },
        { "slot": 1, "seq": 1602, "offset_ms": -22 }
      ],
      "missed_slots": [12, 15],
      "extra_seqs": [1691]
    },
    "quality": {
      "event_confidence_mean": 0.86,
      "analysis_confidence": 0.88
    }
  },
  "segmenterFlags": {
    "late_start": false,
    "missed_count_in": false,
    "extra_events_after_end": false,
    "extra_bars": false,
    "partial_take": false,
    "tempo_mismatch": false,
    "restart_detected": false,
    "low_confidence_events": 0
  },
  "finalize_reason": "GRID_COMPLETE",
  "userSignals": {
    "mode": "PRACTICE",
    "backoff": "L1",
    "nowMs": 1001579,
    "timeSinceLastNoteOnMs": 2000,
    "phraseBoundaryDetected": true,
    "timeSincePhraseBoundaryMs": 1800,
    "ignoreStreak": 0,
    "silencePreference": 0.2,
    "userExplicitQuiet": false,
    "modeConfidence": 0.9
  },
  "policyConfig": {
    "minPauseMs": 900,
    "betweenPhraseOnly": true,
    "interruptBudgetPerMin": 2,
    "version": "fixture_nasties_v1",
    "matrix": {
      "NEUTRAL": {
        "L0": {
          "interruptBudgetPerMin": 2,
          "minPauseMs": 700,
          "betweenPhraseOnly": false,
          "realTimeEnabled": true,
          "granularity": "phrase",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 1, "visual": 1, "audio": 1, "text": 0.5 },
          "tone": "supportive",
          "assist": { "tempoStabilization": true, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L1": {
          "interruptBudgetPerMin": 2,
          "minPauseMs": 900,
          "betweenPhraseOnly": true,
          "realTimeEnabled": true,
          "granularity": "phrase",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 1, "visual": 1, "audio": 0.6, "text": 0.4 },
          "tone": "supportive",
          "assist": { "tempoStabilization": true, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L2": {
          "interruptBudgetPerMin": 1,
          "minPauseMs": 1200,
          "betweenPhraseOnly": true,
          "realTimeEnabled": true,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 1, "visual": 0.8, "audio": 0.2, "text": 0.5 },
          "tone": "suggestive",
          "assist": { "tempoStabilization": true, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L3": {
          "interruptBudgetPerMin": 0.5,
          "minPauseMs": 1500,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.8, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L4": {
          "interruptBudgetPerMin": 0.25,
          "minPauseMs": 2000,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.6, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        }
      },
      "PRACTICE": {
        "L0": {
          "interruptBudgetPerMin": 2,
          "minPauseMs": 700,
          "betweenPhraseOnly": false,
          "realTimeEnabled": true,
          "granularity": "micro",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 1, "visual": 1, "audio": 0.8, "text": 0.4 },
          "tone": "supportive",
          "assist": { "tempoStabilization": true, "phraseBoundaryMarking": true, "callResponse": true, "postSessionRecap": true }
        },
        "L1": {
          "interruptBudgetPerMin": 2,
          "minPauseMs": 900,
          "betweenPhraseOnly": true,
          "realTimeEnabled": true,
          "granularity": "phrase",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 1, "visual": 1, "audio": 0.6, "text": 0.4 },
          "tone": "supportive",
          "assist": { "tempoStabilization": true, "phraseBoundaryMarking": true, "callResponse": true, "postSessionRecap": true }
        },
        "L2": {
          "interruptBudgetPerMin": 1,
          "minPauseMs": 1200,
          "betweenPhraseOnly": true,
          "realTimeEnabled": true,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 1, "visual": 0.8, "audio": 0.2, "text": 0.5 },
          "tone": "suggestive",
          "assist": { "tempoStabilization": true, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L3": {
          "interruptBudgetPerMin": 0.5,
          "minPauseMs": 1500,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.8, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L4": {
          "interruptBudgetPerMin": 0.25,
          "minPauseMs": 2000,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.6, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        }
      },
      "PERFORMANCE": {
        "L0": {
          "interruptBudgetPerMin": 0.5,
          "minPauseMs": 1500,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.8, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L1": {
          "interruptBudgetPerMin": 0.5,
          "minPauseMs": 1500,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.8, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L2": {
          "interruptBudgetPerMin": 0.25,
          "minPauseMs": 2000,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.6, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L3": {
          "interruptBudgetPerMin": 0.25,
          "minPauseMs": 2500,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.6, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L4": {
          "interruptBudgetPerMin": 0.1,
          "minPauseMs": 3000,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.4, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        }
      },
      "EXPLORATION": {
        "L0": {
          "interruptBudgetPerMin": 1,
          "minPauseMs": 900,
          "betweenPhraseOnly": true,
          "realTimeEnabled": true,
          "granularity": "phrase",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 1, "visual": 1, "audio": 0.5, "text": 0.8 },
          "tone": "suggestive",
          "assist": { "tempoStabilization": true, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L1": {
          "interruptBudgetPerMin": 1,
          "minPauseMs": 1200,
          "betweenPhraseOnly": true,
          "realTimeEnabled": true,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 1, "visual": 1, "audio": 0.2, "text": 1 },
          "tone": "suggestive",
          "assist": { "tempoStabilization": true, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L2": {
          "interruptBudgetPerMin": 0.5,
          "minPauseMs": 1500,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.8, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L3": {
          "interruptBudgetPerMin": 0.25,
          "minPauseMs": 2000,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.6, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        },
        "L4": {
          "interruptBudgetPerMin": 0.1,
          "minPauseMs": 2500,
          "betweenPhraseOnly": true,
          "realTimeEnabled": false,
          "granularity": "summary",
          "maxCuesPerIntervention": 1,
          "modalityWeights": { "haptic": 0.4, "visual": 1, "audio": 0, "text": 1 },
          "tone": "silent",
          "assist": { "tempoStabilization": false, "phraseBoundaryMarking": true, "callResponse": false, "postSessionRecap": true }
        }
      }
    },
    "runtime": {
      "tokenBucket": {
        "maxTokens": 1,
        "stochasticRounding": false,
        "cooldownAfterInterventionMs": 10000
      },
      "safeWindow": {
        "phraseBoundaryRequiredAtOrAboveBackoff": "L1",
        "minPauseMsByBackoff": { "L0": 700, "L1": 900, "L2": 1200, "L3": 1500, "L4": 2000 },
        "phraseBoundaryDebounceMs": 250,
        "silenceGateExtraPauseMs": 200
      },
      "globalRules": {
        "performanceNeverInstructive": true,
        "performanceNoMicroGranularity": true,
        "backoffAtOrAboveL2ForcesBetweenPhraseOnly": true,
        "ignoreStreakClamp": { "ignoreStreakThreshold": 2, "maxInterruptBudgetPerMin": 0.5, "extraPauseMs": 400 }
      },
      "modalityAvailability": { "haptic": true, "visual": true, "audio": true, "text": true }
    }
  },
  "deviceCapabilities": {
    "modalitiesAvailable": ["haptic"]
  },
  "expected": {
    "intent": "subdivision_support",
    "cue_key": "add_subdivision_pulse",
    "shouldInitiate": true,
    "selected_modality": "haptic",
    "pulseConfig": {
      "deliver_at_ms_expected": 1001579,
      "max_snap_ms_expected": 80,
      "grid_boundary_ms": 1001500,
      "next_boundary_ms": 1001875,
      "comment": "NOTE: Snap tolerance not implemented in runner. Current behavior uses grid_start_ms directly. Future: 79ms inside tolerance should snap backward to boundary."
    },
    "pulse": {
      "pulse_type": "subdivision",
      "expected_first_4_times_ms": [1003079, 1003454, 1003829, 1004204]
    }
  }
}
